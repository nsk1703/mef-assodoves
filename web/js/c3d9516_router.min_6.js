!function(e,t){var n=t();'function'==typeof define&&define.amd?define([],n.Routing):'object'==typeof module&&module.exports?module.exports=n.Routing:(e.Routing=n.Routing,e.fos={Router:n.Router})}(this,function(){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')};var o=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])};return e},n='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},r=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}};return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),e=function(){function e(t,n){i(this,e),this.context_=t||{base_url:'',prefix:'',host:'',port:'',scheme:'',locale:''},this.setRoutes(n||{})};return r(e,[{key:'setRoutingData',value:function(e){this.setBaseUrl(e.base_url),this.setRoutes(e.routes),'prefix'in e&&this.setPrefix(e.prefix),'port'in e&&this.setPort(e.port),'locale'in e&&this.setLocale(e.locale),this.setHost(e.host),this.setScheme(e.scheme)}},{key:'setRoutes',value:function(e){this.routes_=Object.freeze(e)}},{key:'getRoutes',value:function(){return this.routes_}},{key:'setBaseUrl',value:function(e){this.context_.base_url=e}},{key:'getBaseUrl',value:function(){return this.context_.base_url}},{key:'setPrefix',value:function(e){this.context_.prefix=e}},{key:'setScheme',value:function(e){this.context_.scheme=e}},{key:'getScheme',value:function(){return this.context_.scheme}},{key:'setHost',value:function(e){this.context_.host=e}},{key:'getHost',value:function(){return this.context_.host}},{key:'setPort',value:function(e){this.context_.port=e}},{key:'getPort',value:function(){return this.context_.port}},{key:'setLocale',value:function(e){this.context_.locale=e}},{key:'getLocale',value:function(){return this.context_.locale}},{key:'buildQueryParams',value:function(e,t,o){var i=this,r=void 0,u=new RegExp(/\[\]$/);if(t instanceof Array)t.forEach(function(t,r){u.test(e)?o(e,t):i.buildQueryParams(e+'['+('object'===('undefined'==typeof t?'undefined':n(t))?r:'')+']',t,o)});else if('object'===('undefined'==typeof t?'undefined':n(t)))for(r in t)this.buildQueryParams(e+'['+r+']',t[r],o);else o(e,t)}},{key:'getRoute',value:function(e){var o=this.context_.prefix+e,r=e+'.'+this.context_.locale,i=this.context_.prefix+e+'.'+this.context_.locale,t=[o,r,i,e];for(var n in t)if(t[n]in this.routes_)return this.routes_[t[n]];throw new Error('The route "'+e+'" does not exist.')}},{key:'generate',value:function(t,s){var m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getRoute(t),c=s||{},a=o({},c),n='',l=!0,u='',i='undefined'==typeof this.getPort()||null===this.getPort()?'':this.getPort();if(r.tokens.forEach(function(o){if('text'===o[0])return n=e.encodePathComponent(o[1])+n,void(l=!1);{if('variable'!==o[0])throw new Error('The token type "'+o[0]+'" is not supported.');var s=r.defaults&&o[3]in r.defaults;if(!1===l||!s||o[3]in c&&c[o[3]]!=r.defaults[o[3]]){var i=void 0;if(o[3]in c)i=c[o[3]],delete a[o[3]];else{if(!s){if(l)return;throw new Error('The route "'+t+'" requires the parameter "'+o[3]+'".')};i=r.defaults[o[3]]};var f=!0===i||!1===i||''===i;if(!f||!l){var u=e.encodePathComponent(i);'null'===u&&null===i&&(u=''),n=o[1]+u+n};l=!1}
else s&&o[3]in a&&delete a[o[3]]}}),''===n&&(n='/'),r.hosttokens.forEach(function(e){var t=void 0;return'text'===e[0]?void(u=e[1]+u):void('variable'===e[0]&&(e[3]in c?(t=c[e[3]],delete a[e[3]]):r.defaults&&e[3]in r.defaults&&(t=r.defaults[e[3]]),u=e[1]+t+u))}),n=this.context_.base_url+n,r.requirements&&'_scheme'in r.requirements&&this.getScheme()!=r.requirements._scheme){var d=u||this.getHost();n=r.requirements._scheme+'://'+d+(d.indexOf(':'+i)>-1||''===i?'':':'+i)+n}
else if('undefined'!=typeof r.schemes&&'undefined'!=typeof r.schemes[0]&&this.getScheme()!==r.schemes[0]){var p=u||this.getHost();n=r.schemes[0]+'://'+p+(p.indexOf(':'+i)>-1||''===i?'':':'+i)+n}
else u&&this.getHost()!==u+(u.indexOf(':'+i)>-1||''===i?'':':'+i)?n=this.getScheme()+'://'+u+(u.indexOf(':'+i)>-1||''===i?'':':'+i)+n:m===!0&&(n=this.getScheme()+'://'+this.getHost()+(this.getHost().indexOf(':'+i)>-1||''===i?'':':'+i)+n);if(Object.keys(a).length>0){var f=void 0,h=[],y=function(t,n){n='function'==typeof n?n():n,n=null===n?'':n,h.push(e.encodeQueryComponent(t)+'='+e.encodeQueryComponent(n))};for(f in a)this.buildQueryParams(f,a[f],y);n=n+'?'+h.join('&')};return n}}],[{key:'getInstance',value:function(){return t}},{key:'setData',value:function(t){var n=e.getInstance();n.setRoutingData(t)}},{key:'customEncodeURIComponent',value:function(e){return encodeURIComponent(e).replace(/%2F/g,'/').replace(/%40/g,'@').replace(/%3A/g,':').replace(/%21/g,'!').replace(/%3B/g,';').replace(/%2C/g,',').replace(/%2A/g,'*').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/'/g,'%27')}},{key:'encodePathComponent',value:function(t){return e.customEncodeURIComponent(t).replace(/%3D/g,'=').replace(/%2B/g,'+').replace(/%21/g,'!').replace(/%7C/g,'|')}},{key:'encodeQueryComponent',value:function(t){return e.customEncodeURIComponent(t).replace(/%3F/g,'?')}}]),e}();e.Route,e.Context;var t=new e;return{Router:e,Routing:t}});